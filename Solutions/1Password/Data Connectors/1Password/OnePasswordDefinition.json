{
    "apiVersion": "2022-09-01-preview",
    "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
    "name": "OnePassword",
    "location": "{{location}}",
    "kind": "Customizable",
    "properties": {
        "connectorUiConfig": {
            "id": "1Password",
            "title": "1Password",
            "publisher": "1Password",
            "descriptionMarkdown": "The [1Password](https://www.1password.com) solution for Microsoft Sentinel enables you to ingest 1Password logs and events into Microsoft Sentinel. The connector provides visibility into 1Password Events and Alerts in Microsoft Sentinel to improve monitoring and investigation capabilities.\n\n**Underlying Microsoft Technologies used:**\n\nThis solution takes a dependency on the following technologies, and some of these dependencies either may be in [Preview](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) state or might result in additional ingestion or operational costs:\n\n-  [Azure Functions](https://azure.microsoft.com/services/functions/#overview)",
            "additionalRequirementBanner": "These queries are dependent on a parser based on a Kusto Function deployed as part of the solution.",
            "graphQueriesTableName": "OnePasswordEventLogs_CL",
            "graphQueries": [
                {
                  "metricName": "Total data received",
                  "legend": "1Password",
                  "baseQuery": "{{graphQueriesTableName}}"
                }
              ],
              "sampleQueries": [
                {
                  "description": "Get Sample of 1Password events",
                  "query": "{{graphQueriesTableName}}\n | summarize count() by tostring(target_user.name)\n | where target_user.name <> ''\n | top 10 by count_"
                }
              ],
            "dataTypes": [
                {
                    "name": "{{graphQueriesTableName}}",
                    "lastDataReceivedQuery": "{{graphQueriesTableName}}\n | where TimeGenerated > ago(12h) | where name_s == \"no data test\" | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                }
            ],
            "connectivityCriteria": [
                {
                    "type": "HasDataConnectors"
                }
            ],
            
            "availability": {
                "isPreview": true
            },
            "permissions": {
                "resourceProvider": [
                  {
                    "provider": "Microsoft.OperationalInsights/workspaces",
                    "permissionsDisplayText": "read and write permissions on the workspace are required.",
                    "providerDisplayName": "Workspace",
                    "scope": "Workspace",
                    "requiredPermissions": {
                      "write": true,
                      "read": true,
                      "delete": true
                    }
                  }
                ],
                "customs": [
                  {
                    "name": "Microsoft.Web/sites permissions",
                    "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                  },
                  {
                    "name": "1Password API Token",
                    "description": "A 1Password API Token is required. [See the documentation to learn more about the 1Password API](https://developer.1password.com/docs/events-api/reference). **Note:** A 1Password account is required"
                  }
                ]
              },
              "instructionSteps": [
                {
                    "title": "STEP 1 - Create a 1Password API token",
                    "description": "Follow the [1Password documentation](https://support.1password.com/events-reporting/#appendix-issue-or-revoke-bearer-tokens) for guidance on this step."
                },
                {
                    "title": "STEP 2 - Choose the correct base URL",
                    "description": "There are multiple 1Password servers which might host your events. The correct server depends on your license and region. Follow the [1Password documentation](https://developer.1password.com/docs/events-api/reference/#servers) to choose the correct server. Input the base URL as displayed by the documentation (including 'https://' and without a trailing '/')."
                },
                {
                    "title": "STEP 3 - Enter your 1Password Details",
                    "description": "Enter the 1Password base URL & API Token below:",
                    "instructions": [
                        {
                            "type": "Textbox",
                            "parameters": {
                                "label": "Base Url",
                                "placeholder": "Enter your Base Url",
                                "type": "text",
                                "name": "BaseUrl"
                            }
                        },
                        {
                            "type": "Textbox",
                            "parameters": {
                                "label": "API Token",
                                "placeholder": "Enter your API Token",
                                "type": "password",
                                "name": "ApiToken"
                            }
                        },
                        {
                            "type": "ConnectionToggleButton",
                            "parameters": {
                                "connectLabel": "connect",
                                "name": "connect"
                            }
                        }
                    ]
                }
            ]
        }
    }
}